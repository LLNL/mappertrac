Bootstrap: docker
From: debian:buster-slim
# Generated by Neurodocker and Reproenv.
#
# Modified by Paul Camacho

%environment
    FSLDIR="/opt/fsl-6.0.5.1" 
    PATH="/opt/fsl-6.0.5.1/bin:$PATH" 
    FSLOUTPUTTYPE="NIFTI_GZ" 
    FSLMULTIFILEQUIT="TRUE"
    FSLTCLSH="/opt/fsl-6.0.5.1/bin/fsltclsh"
    FSLWISH="/opt/fsl-6.0.5.1/bin/fslwish"
    FSLLOCKDIR=""
    FSLMACHINELIST="" 
    FSLREMOTECALL="" 
    FSLGECUDAQ="cuda.q"
    export $FSLDIR="/opt/fsl-6.0.5.1" 
    COMPILE_GPU=1
    export FSL_DIR FSLOUTPUTTYPE FSLMULTIFILEQUIT FSLTCLSH FSLWISH FSLGECUDAQ FSL_BIN FS_OVERRIDE COMPILE_GPU
    export CUDA_10_2_LIB_DIR=/usr/local/cuda-10.2/lib64
    export PATH="${FSLDIR}/bin:$PATH"
    export LD_LIBRARY_PATH="${FSLDIR}/lib:$LD_LIBRARY_PATH"
    export OS=LINUX

%post

    apt-get update -qq \
    && apt-get install -y -q --no-install-recommends \
           bc \
           ca-certificates \
           curl \
           dc \
           file \
           libfontconfig1 \
           libfreetype6 \
           libgl1-mesa-dev \
           libgl1-mesa-dri \
           libglu1-mesa-dev \
           libgomp1 \
           libice6 \
           libopenblas-base \
           libxcursor1 \
           libxft2 \
           libxinerama1 \
           libxrandr2 \
           libxrender1 \
           libxt6 \
           nano \
           sudo \
           wget \
    && rm -rf /var/lib/apt/lists/* \
    && echo "Downloading FSL ..." \
    && mkdir -p /opt/fsl-6.0.5.1 \
    && curl -fL https://fsl.fmrib.ox.ac.uk/fsldownloads/fsl-6.0.5.1-centos7_64.tar.gz \
    | tar -xz -C /opt/fsl-6.0.5.1 --strip-components 1 \
    && echo "Installing FSL conda environment ..." \
    && bash /opt/fsl-6.0.5.1/etc/fslconf/fslpython_install.sh -f /opt/fsl-6.0.5.1

